  <script>
    // EDIT HERE --------------------------------------------------------
    const my_products = [
      "Visible Alpha Insights",
      "iLevel Portfolio Monitoring Software",
      "Managed Services",
      "Kensho Extract",
    ];
    // EDIT ABOVE --------------------------------------------------------

    // Store the found products
    var found_products = [];

    // Define the URL of the JSON file
    const url =
      "https://www.spglobal.com/content/dam/spglobal/corporate/en/products/product-finder/spark-product-list.json";
    var product_list = [];

    // Create an async function to fetch the data
    async function getProductList() {
      try {
        // Await the fetch call to the URL
        const response = await fetch(url);

        // Check if the response was successful (status code 200-299)
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }

        // Await the parsing of the response body as JSON
        product_list = await response.json();

        // Log the resulting JSON data to the console
        console.log("Successfully fetched product data");

        // Iterate through the products you are searching for
        for (var i = 0; i < my_products.length; i++) {
          const searchTermRaw = my_products[i];
          // Prepare the search term: remove special characters, convert to lower case, and split into words.
          // Filtering out empty strings handles cases with multiple spaces.
          const searchWords = removeSpecialCharacters(searchTermRaw)
            .toLowerCase()
            .split(" ")
            .filter((word) => word.length > 0);

          let bestMatch = null;
          let highestScore = 0;
          let bestMatchIndex = -1;

          // Iterate through the entire product list to score each one against the search term
          product_list.forEach((product, index) => {
            const productName = removeSpecialCharacters(
              product.Product["Product Name"]
            ).toLowerCase();
            let currentScore = 0;

            // Increase score for each search word found in the product name
            searchWords.forEach((word) => {
              if (productName.includes(word)) {
                currentScore++;
              }
            });

            // If the current product has a better score, it becomes the new best match
            if (currentScore > highestScore) {
              highestScore = currentScore;
              bestMatch = product;
              bestMatchIndex = index;
            }
          });

          // A match is only considered valid if at least one word matched (score > 0)
          if (bestMatch) {
            // Store it in the found products array
            found_products.push(bestMatch);
            // You can now use bestMatch as needed
            document.getElementById("card_grid").innerHTML += generateCard(
              bestMatch,
              bestMatchIndex
            );
          } else {
            console.log("Product not found for:", searchTermRaw);
          }
        }

        // Generate Details for the first product
        generateDetails(found_products[0]);
        //
      } catch (error) {
        // Catch any errors that occurred during the fetch or parsing
        console.error("Could not fetch the product list:", error);
      }
    }

    // Call the function to execute it
    getProductList();

    // --- NEW --- Handles the click event on a product card
    function handleCardClick(index) {
      // Find the product in our main list using the index from the button
      const product = product_list[index];
      if (product) {
        // Call generateDetails with the correct product object
        generateDetails(product);
        // Scroll the details section into view for a better user experience
        document.getElementById('summary_container').scrollIntoView({ behavior: 'smooth' });
      }
    }


    // Convert to unicode
    function removeSpecialCharacters(str) {
      return str
        .replace(/[^\w\s]|_/g, "") // Remove special characters
        .replace(/\s+/g, " "); // Replace multiple spaces with a single space
    }

    function generateCard(_current_product, _index) {
      let card = `
        <button class="product_card" data-index="${_index}" onclick="handleCardClick(${_index})">
            <div class="caps-bold-micro block text-black-base">${_current_product["Product"]["Division"]}</div>
            <h4 style="margin: 0.5rem 0;">${_current_product["Product"]["Product Name"]}</h4>
            <div class="body-regular-s limit_text">${_current_product["Product Overview"]["Overview"]}</div>
        </button>
    `;
      return card;
    }

    function generateDetails(_current_product) {
      // Product Index
      const product = _current_product;
      // console.log(product);
      const productContainer = document.getElementById("body_container");

      let summaryContainer = document.getElementById("summary_container");
      if (!summaryContainer) {
        summaryContainer = document.createElement("div");
        summaryContainer.id = "summary_container";
        summaryContainer.classList.add("section-container");
        summaryContainer.style.marginBottom = "4rem";
        productContainer.prepend(summaryContainer);
      } else {
        summaryContainer.innerHTML = ""; // Clear previous content
      }

      const column_left = document.createElement("div");
      column_left.classList.add("column-left");
      summaryContainer.appendChild(column_left);

      const column_right = document.createElement("div");
      column_right.classList.add("column-right");
      summaryContainer.appendChild(column_right);

        // Recommended Tag
      const recommended = document.createElement("div");
      recommended.classList.add("caps-bold-micro");
      recommended.classList.add("text-red-core");
      recommended.style.marginBottom = "2rem";
      recommended.innerText = "Recommended";
      column_left.appendChild(recommended);

      // Add Tags
      const divisionTitle = document.createElement("div");
      divisionTitle.innerHTML =
        "<b>" +
        _current_product["Product"]["Division"] +
        "</b> | " +
        _current_product["Product"]["Type"];
    divisionTitle.style.marginBottom = "1rem";
      column_left.appendChild(divisionTitle);

      // Product Name
      const productHeadlineLink = document.createElement("h2");
      productHeadlineLink.id = "product-headline"; // Keep the original ID for potential styling
      //productHeadlineLink.classList.add("product-link"); // Add the product-link class for consistency
      productHeadlineLink.innerText =
        _current_product["Product"]["Product Name"];
      //productHeadlineLink.style.textDecoration = "none"; // Remove underline
      column_left.appendChild(productHeadlineLink);

      // Product Description
      const productDescription = document.createElement("p");
      productDescription.classList.add("body-regular-l");
      productDescription.id = "product-description";
      productDescription.style.marginTop = "1rem";
      productDescription.style.marginBottom = "1rem";
      productDescription.innerText =
        _current_product["Product Overview"]["Overview"];

      column_left.appendChild(productDescription);

      // Learn more
      const learnMoreLink = document.createElement("a");
      learnMoreLink.href = _current_product["Product"]["Source"];
      learnMoreLink.target = "_blank"; // Open in a new tab
      learnMoreLink.className = "learn-more-link";
      learnMoreLink.innerText = "Learn more";
      learnMoreLink.style.fontWeight = "bold";
      learnMoreLink.style.color = "#d6002a";
      learnMoreLink.style.marginTop = "1rem";
      column_left.appendChild(learnMoreLink);

      // Add Features & Benefits
      const aiFeatures = document.createElement("div");
      aiFeatures.textContent = "Features & Benefits";
      aiFeatures.classList.add("caps-bold-micro");
      aiFeatures.classList.add("text-red-core");
      column_right.appendChild(aiFeatures);

      // List
      createSummaryElements(
        _current_product["Product Overview"]["Key Features"],
        column_right
      );
    }
    
    // --- UPDATED FUNCTION ---
    function createSummaryElements(dataArray, parentContainer) {
        dataArray.forEach((item, index) => {
            const rowDiv = document.createElement("div");
            // Add a class for easy selection and another to hide if necessary
            rowDiv.classList.add("feature-item");
            if (index >= 5) {
                rowDiv.classList.add("hidden");
            }

            const titleColumn = document.createElement("div");
            titleColumn.style.marginTop = "2rem";
            const titleHeader = document.createElement("h4");
            titleHeader.textContent = item["Feature"];
            titleHeader.style.marginBottom = "0.5rem";
            titleColumn.appendChild(titleHeader);

            const descriptionColumn = document.createElement("div");
            const descriptionParagraph = document.createElement("p");
            descriptionParagraph.textContent = item["Description"];
            descriptionParagraph.classList.add("body-regular-s");
            descriptionColumn.appendChild(descriptionParagraph);

            rowDiv.appendChild(titleColumn);
            rowDiv.appendChild(descriptionColumn);
            parentContainer.appendChild(rowDiv);
        });

        // Add "Show more" button if there are more than 5 items
        if (dataArray.length > 5) {
            const showMoreBtn = document.createElement("button");
            showMoreBtn.id = "show-more-btn";
            showMoreBtn.classList.add("body-bold-s");
            showMoreBtn.textContent = "Show more";
            
            showMoreBtn.onclick = function() {
                // Find the parent container of the button, which also contains the items
                const container = this.parentElement; 
                const isShowingAll = this.textContent === "Show less";
                
                // Select all feature items within that same container
                const allItems = container.querySelectorAll(".feature-item");

                allItems.forEach((item, index) => {
                    if (index >= 5) {
                        // The second argument of 'toggle' is a boolean:
                        // true = add the class, false = remove the class.
                        // We want to HIDE when isShowingAll is true, so we add the 'hidden' class.
                        item.classList.toggle("hidden", isShowingAll);
                    }
                });

                // Toggle button text
                this.textContent = isShowingAll ? "Show more" : "Show less";
            };

            parentContainer.appendChild(showMoreBtn);
        }
    }
  </script>
  <style>
      .product_container {
        display: block;
      }

      .container {
        text-align: center;
        background-color: #ffffff;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      #headline {
        color: #333333;
      }

      #status {
        color: #555555;
        margin-bottom: 20px;
      }

      #download_buttons button {
        background-color: #d6002a; /* S&P Global Red */
        color: white;
        border: none;
        padding: 12px 24px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        border-radius: 4px;
        transition: background-color 0.2s ease-in-out; /* Smooth hover effect */
      }

      #download_buttons button:hover {
        background-color: #000000; /* Black fill on hover */
      }

      .product_card {
        display: flex;
        flex-direction: column; /* Stacks children vertically */
        justify-content: top; /* Vertically centers content */

        padding: 1.5rem;
        border: 0;
        border-radius: 0;

        background-color: #deecf0;
        width: calc(100%);

        text-align: left;
        vertical-align: top;
        font-size: 1.375rem;
        transition: transform 0.2s ease-in-out,
          background-color 0.2s ease-in-out; /* Add transition for background-color */
      }

      .product_card:hover {
        transform: translateY(-4px); /* Raise the card by 6px */
      }

      .product_card:hover b,
      .product_card:hover strong {
        text-decoration: underline;
      }

      .division_title {
        font-size: 0.75rem;
        color: #555;
        margin-bottom: 0.25rem;
      }

      .product_description {
        color: #555; /* Dark text color */
        font-size: 0.75rem;
        margin-top: 1rem;
        line-height: 1.5;
      }

      .limit_text {
        display: -webkit-box !important;
        -webkit-line-clamp: 5; /* Limits the text to 5 lines */
        -webkit-box-orient: vertical;
        overflow: hidden; /* Hides any overflowing content */
        text-overflow: ellipsis; /* Adds an ellipsis (...) at the end if content is truncated */
      }

      .button_grid_container {
        /* Base styles for mobile (1 column) */
        display: grid;
        grid-template-columns: 1fr; /* 1 column by default */
        gap: 32px; /* Gap between grid items */
        padding: 0; /* Padding around the container */
        width: 100%; /* Take full width */
        box-sizing: border-box; /* Include padding in element's total width and height */
      }

      .features-overline {
        margin-top: 0;
      }

      .section-container {
        display: grid;
        grid-template-columns: 1fr; /* 1 column by default */
        gap: 48px; /* Gap between grid items */
        /* padding: 2rem;  Padding around the container */
        width: 100%; /* Take full width */
        box-sizing: border-box; /* Include padding in element's total width and height */

        border-radius: 0;
        margin-bottom: 1rem;
      }
      
      /* --- NEW STYLES --- */
      .feature-item.hidden {
        display: none;
      }

      #show-more-btn {
        background-color: transparent;
        border: 1px solid #000;
        color: #000;
        padding: 8px 16px;
        margin-top: 1rem;
        cursor: pointer;
        font-weight: bold;
        border-radius: 0;
        transition: all 0.2s ease-in-out;
      }

      #show-more-btn:hover {
        background-color: #e0e0e0;
        border-color: #000;
      }
      /* --- END NEW STYLES --- */


      /* Tablet breakpoint (768px and up): 2 columns */
      @media (min-width: 768px) {
        .button_grid_container {
          grid-template-columns: repeat(2, 1fr); /* 2 columns */
        }
      }

      /* Desktop breakpoint (1024px and up): 4 columns */
      @media (min-width: 1024px) {
        .button_grid_container {
          grid-template-columns: repeat(4, 1fr); /* 4 columns */
        }

        .section-container {
          grid-template-columns: repeat(2, 1fr); /* 2 columns */
        }
      }
    </style>
  <div class="product_container">
    <div id="body_container"></div>
    <div id="card_grid" class="button_grid_container"></div>
  </div>